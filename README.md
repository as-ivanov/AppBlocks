## CodeGeneration.Roslyn.Logger
Utility for generating high-performance logger types using LoggerMessage pattern: https://docs.microsoft.com/en-us/aspnet/core/fundamentals/logging/loggermessage


## Info

[![Build Status](https://alexey-ivanov.visualstudio.com/CodeGeneration.Roslyn.AppBlocks/_apis/build/status/as-ivanov.CodeGeneration.Roslyn.AppBlocks?branchName=master)](https://alexey-ivanov.visualstudio.com/CodeGeneration.Roslyn.AppBlocks/_build/latest?definitionId=1&branchName=master)

Package | Version 
------- | ------- 
CodeGeneration.Roslyn.Logger | [![NuGet package](https://img.shields.io/nuget/v/CodeGeneration.Roslyn.Logger.svg)][GeneratorNuPkg]
CodeGeneration.Roslyn.Logger.Attributes | [![NuGet package](https://img.shields.io/nuget/v/CodeGeneration.Roslyn.Logger.Attributes.svg)][AttributesNuPkg]

[GeneratorNuPkg]: https://nuget.org/packages/CodeGeneration.Roslyn.Logger
[AttributesNuPkg]: https://nuget.org/packages/CodeGeneration.Roslyn.Logger.Attributes

## Installation

Add to your project file the following:

```xml
<Project>
   ...    
  <ItemGroup>
      <PackageReference Include="CodeGeneration.Roslyn.BuildTime"
                      Version="0.7.5-alpha"
                      PrivateAssets="all" />
    
    <DotNetCliToolReference Include="dotnet-codegen" 
                            Version="0.7.5-alpha" />
    <PackageReference Include="CodeGeneration.Roslyn.Logger" Version="0.1.0-alpha" PrivateAssets="all"/>
    <PackageReference Include="CodeGeneration.Roslyn.Logger.Attributes" Version="0.1.0-alpha" PrivateAssets="all"/>
  </ItemGroup>
  ...  
</Project>
```

## Usage

Add interface which logger should implement. It should be marked with LoggerStub attribute which optionally accepts the list of extra interfaces logger is supposed to inherit (e.g. meta interfaces).

Methods may contain LoggerMethodStub attribute to provide extra information: LogLevel (Information by default) and message (Logger method name by default).

```cs
using System;
using CodeGeneration.Roslyn.Logger.Attributes;
using Microsoft.Extensions.Logging;

namespace CodeGeneration.Roslyn.Logger.Sample
{
	[LoggerStub("CodeGeneration.Roslyn.Logger.Sample.ISingletonDependency", "CodeGeneration.Roslyn.Logger.Sample.ILoggerImplementation")]
	public interface IBackgroundTaskManagerLogger
	{
		[LoggerMethodStub(LogLevel.Information, "Task execution started.")]
		void ExecutionStarted(string taskName);

		[LoggerMethodStub(LogLevel.Information, "Task execution finished.")]
		void ExecutionFinished(string taskName);

		[LoggerMethodStub(LogLevel.Information, "Task execution failed.")]
		void ExecutionFailed(string taskName, Exception error);
	}
}
```

On pre-build the following implementation will be generated:

```cs
// ------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool.
//
//     Changes to this file may cause incorrect behavior and will be lost if
//     the code is regenerated.
// </auto-generated>
// ------------------------------------------------------------------------------

using System;
using CodeGeneration.Roslyn.Logger.Attributes;
using Microsoft.Extensions.Logging;

namespace CodeGeneration.Roslyn.Logger.Sample
{
    public class BackgroundTaskManagerLogger : IBackgroundTaskManagerLogger, CodeGeneration.Roslyn.Logger.Sample.ISingletonDependency, CodeGeneration.Roslyn.Logger.Sample.ILoggerImplementation
    {
        protected readonly ILogger _logger;
        private static readonly Action<ILogger, object, System.Exception> _executionStarted = LoggerMessage.Define<object>(LogLevel.Information, new EventId(1, nameof(ExecutionStarted)), @"Task execution started.. TaskName: ""{TaskName}""");
        private static readonly Action<ILogger, object, System.Exception> _executionFinished = LoggerMessage.Define<object>(LogLevel.Information, new EventId(2, nameof(ExecutionFinished)), @"Task execution finished.. TaskName: ""{TaskName}""");
        private static readonly Action<ILogger, object, System.Exception> _executionFailed = LoggerMessage.Define<object>(LogLevel.Information, new EventId(3, nameof(ExecutionFailed)), @"Task execution failed.. TaskName: ""{TaskName}""");
        public BackgroundTaskManagerLogger(ILoggerFactory loggerFactory)
        {
            _logger = loggerFactory.CreateLogger(GetType());
        }

        public void ExecutionStarted(string taskName)
        {
            if (_logger.IsEnabled(LogLevel.Information))
            {
                _executionStarted(_logger, taskName, null);
            }
        }

        public void ExecutionFinished(string taskName)
        {
            if (_logger.IsEnabled(LogLevel.Information))
            {
                _executionFinished(_logger, taskName, null);
            }
        }

        public void ExecutionFailed(string taskName, Exception error)
        {
            if (_logger.IsEnabled(LogLevel.Information))
            {
                _executionFailed(_logger, taskName, error);
            }
        }
    }
}
```

## Credits

The generator is based on @AArnott work [AArnott's CodeGeneration.Roslyn](https://github.com/AArnott/CodeGeneration.Roslyn).

## License

MIT
